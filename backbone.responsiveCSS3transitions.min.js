/*!
 * backbone.responsiveCSS3transitions v0.3.1
 * git://github.com/techjacker/Backbone-Responsive-CSS3-Page-Transitions.git
 *
 * Demos: http://projects.andrewgriffithsonline.com/#backbone-responsive-CSS3-page-transitions
 * Documentation: https://github.com/techjacker/Backbone-Responsive-CSS3-Page-Transitions
 *
 * Copyright 2013, Andrew Griffiths
 * Released under a MIT license
 *
 * Date: 2013-02-20
 */
(function(e,t){"use strict";typeof define=="function"&&define.amd?define(["backbone"],t):e.backboneResponsiveCSS3Transitions=t(e.Backbone)})(this,function(e){"use strict";var t=function(t){_(this).bindAll("pageTransitionAnimation","insertNewPageDefault","calculateDirection","triggerTransition","resetCssContainers","setPagePreAnimationStyles","clearUpAfterTransition","setOutmostContainerPreAnimationStyles"),t&&(this.wrapElement=t.wrapElement,this.renderCallback=t.renderCallback,this.fastClick=t.fastClick),this.callBackCounter=0,this.debugCounter=0,this.threeDEnabled=this.csstransforms3d(),this.domSetUp(),e.Router.apply(this,[t])};return _.extend(t.prototype,e.Router.prototype,{setOutmostContainerPreAnimationStyles:function(e,t){e instanceof jQuery||(e=$(this.wrapElement));if(!e.size())return;parseInt(t,10)||(t=parseInt($(window).width(),10));var n=parseInt(e.css("width"),10),r=parseInt(e.css("min-width"),10),i=parseInt(e.css("max-width"),10),s=parseInt(e.css("margin-right"),10),o=parseInt(e.css("margin-left"),10);return!s&&!o&&t!==n&&(s=o=Math.abs((t-n)/2)),this.cssOutmostDiv={height:$(window).height(),width:n,"margin-right":s,"margin-left":o,"min-width":r,"max-width":i},this.$outmostContainer.css(this.cssOutmostDiv),this.trigger("threeDTrans.setOutmostContainerPreAnimationStyles"),this.cssOutmostDiv},resetCssContainers:function(){this.$outmostContainer.css({width:"",height:"","margin-right":"","margin-left":"","min-width":"","max-width":""}),this.newView.$el.css({width:"",height:""})},domSetUp:function(){var e,t;this.wrapElement&&(e=$(this.wrapElement)).size()&&(e.wrap('<div class="threeDTrans-page-container" />'),e.parent().wrap('<div class="threeDTrans-outmost-page-container" />')),this.$outmostContainer=$(".threeDTrans-outmost-page-container"),this.$container=this.$outmostContainer.children(".threeDTrans-page-container"),this.hasContainersNeeded=_.all([this.$outmostContainer,this.$container],function(e){return $(e).size()})},removeTrailingSlashes:function(e){return e=e.charAt(0)==="#"?e.slice(1):e,e.replace(/\/+$/,"")},setPagePreAnimationStyles:function(){var e={width:this.cssOutmostDiv.width,height:this.cssOutmostDiv.height};this.newView.$el.css(e),this.initialLoad||this.prevView.$el.css(e)},insertNewPageBeforeAnimation:function(e){e==="backwards"?(this.$container.addClass("threeDTrans-page-container-"+e),this.$container.prepend(this.newView.el)):(this.$container.addClass("threeDTrans-page-container-"+e),this.$container.append(this.newView.el))},pageTransitionAnimation:function(e,t){var n,r=_.bind(this.pageTransitionCallback,this);return this.disableLinks(this.newView),this.setOutmostContainerPreAnimationStyles(),this.setPagePreAnimationStyles(),this.$outmostContainer.addClass("threeDTrans"),this.insertNewPageBeforeAnimation(e),this.newView.$("h1").html(++this.debugCounter),_($.browser).has("mozilla")&&$.browser.mozilla===!0?t.on("transitionend.threeDTrans",r):t.on("webkitTransitionEnd.threeDTrans oTransitionEnd.threeDTrans MSTransitionEnd.threeDTrans",r),t.addClass("threeDTrans-animate-transform"),setTimeout(function(){t.addClass("threeDTrans-animate-"+e)},50),!0},pageTransitionCallback:function(e){var t=$(e.currentTarget),n=t.find(".threeDTrans-page");this.callBackCounter++===1&&n.size()===2&&this.clearUpAfterTransition(t)},clearUpAfterTransition:function(e){e.off(".threeDTrans"),e.removeClass("threeDTrans-animate-transform"),e.removeClass("threeDTrans-animate-forwards threeDTrans-animate-backwards"),this.disposeView(this.prevView),e.removeClass("threeDTrans-page-container-backwards threeDTrans-page-container-forwards"),this.$outmostContainer.removeClass("threeDTrans"),this.resetCssContainers(),this.enableLinks(this.newView),this.callBackCounter=0,this.pageTransInProgress=!1,this.trigger("threeDTrans.pageTransitionComplete")},disableLinks:function(e){setTimeout(function(){e.$("a").on("threeDTrans.click",function(e){e&&e.preventDefault()&&e.stopPropagation()})},50)},enableLinks:function(e){this.fastClick!==undefined&&_.isFunction(this.fastClick)&&new this.fastClick(e.el),setTimeout(function(){e.$("a").off("threeDTrans.click")},50)},unbindViewRenderCallback:function(e){e.renderCb&&e.off("render",e.renderCb)},disposeView:function(e){if(!e)return!1;_.isFunction(e.dispose)?(this.unbindViewRenderCallback(e),e.dispose()):(this.unbindViewRenderCallback(e),e.unbind(),e.remove())},insertNewPageDefault:function(){this.$container.html(this.newView.el)},insertNewPage:{forwards:function(){var e=this;return e.pageTransitionAnimation("forwards",e.$container)},backwards:function(){var e=this;return e.pageTransitionAnimation("backwards",e.$container)},"default":function(){this.insertNewPageDefault(),this.disposeView(this.prevView),this.pageTransInProgress=!1,this.callBackCounter=0,this.trigger("threeDTrans.pageTransitionComplete")}},csstransforms3d:function(){var e=document.createElement("p"),t,n,r={WebkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",Transform:"transform"};document.body.insertBefore(e,null);for(n in r)e.style[n]!==undefined&&(e.style[n]="translate3d(1px,1px,1px)",t=window.getComputedStyle(e).getPropertyValue(r[n]));return document.body.removeChild(e),t!==undefined&&t.length>0&&t!=="none"},calculateDirection:function(e,t,n){var r=_.bind(function(e){return e=e&&e.replace(this.defaultView,""),e&&e.length?e.split("/").length:0},this),i,s,o="default";if(!this.initialLoad&&this.threeDEnabled&&this.hasContainersNeeded){if(n&&_.has(this.insertNewPage,n))return n;_.isString(e)&&(t=t||this.prevView&&this.prevView.hash||"",i=r(e),s=r(t),i!==s&&(o=i>s?"forwards":"backwards"))}return this.direction=o},triggerTransition:function(e,t){var n,r,i,s;if(this.pageTransInProgress===!0||this.callBackCounter!==0)return!1;this.pageTransInProgress=!0,this.callBackCounter=1,t&&(s=t.renderParams,r=_.isObject(t.viewInitOpts)&&t.viewInitOpts,i=t.direction),this.prevView=this.newView,this.initialLoad=!_.isObject(this.prevView),this.newView=new e(r),this.newView.hash||(this.newView.hash=this.removeTrailingSlashes(window.location.hash)),this.newView.render(s),this.newView.$el.addClass("threeDTrans-no-margin-width"),this.newView.renderCb=_.bind(function(){this.newView.$el.hasClass("threeDTrans-page")||this.newView.$el.addClass("threeDTrans-page"),_.bind(this.insertNewPage[this.calculateDirection(this.newView.hash,null,i)],this)()},this),this.renderCallback&&this.newView.on("render",this.newView.renderCb)||this.newView.renderCb()}}),t.extend=e.Router.extend,t});